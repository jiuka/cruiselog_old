<div class="item">
  <b><%= @cruise.ship.title %> - <%= @cruise.title %></b>
  <p id="notice"><%= notice %></p>

  <% if @cruise.itinerary %>
    <ul class="itinerary">
      <li class="port"><i class="inverted circular anchor icon"></i><%= @cruise.itinerary[0].port.title %></li>
      <li class="time leave">Leave: <%= @cruise.itinerary[0].leave %></li>
      <% @cruise.itinerary[1..-2].each do |poc| %>
        <li class="time arrive">Arrive: <%= poc.arrive %></li>
        <li class="port"><i class="inverted circular anchor icon"></i><%= poc.port.title %></li>
        <li class="time leave">Leave: <%= poc.leave %></li>
      <% end %>
      <li class="time arrive">Arrive: <%= @cruise.itinerary[1].arrive %></li>
      <li class="port"><i class="inverted circular anchor icon"></i><%= @cruise.itinerary[-1].port.title %></li>
    </ul>
  <% end %>

<%= link_to 'Edit', edit_cruise_path(@cruise) %> |
<%= link_to 'Back', cruises_path %>
</div>
<% content_for :post_map_js do %>
  <% last_poc = nil %>
  <% @cruise.itinerary.each do |poc| %>
    <% map_marker(poc.port) %>
    <% if last_poc %>
      <%
          route = Route.find_by(:from => last_poc.port.id, :to => poc.port.id)
      if route
        route = route.line
      else
        route = [[last_poc.port.latitude,last_poc.port.longitude],[poc.port.latitude,poc.port.longitude]]
      end
      %>
    addCruiseSegment('<%= last_poc.id %>_<%= poc.id %>', <%= route %>);
    <% end %>
    <% last_poc = poc %>
  <% end %>
<% end %>
