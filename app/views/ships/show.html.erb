<div class="item">
  <b><%= @ship.title %></b>
  <p id="notice"><%= notice %></p>

  <p>
    <strong>Line:</strong>
    <%= @ship.line.title %>
  </p>

  <div class="menu">
    <%= link_to new_ship_port_of_call_path(@ship), class: "item" do %>Add Port of call<i class="add icon"></i><% end %>
    <%= link_to edit_ship_path(@ship), class: "item" do %>Edit <i class="pencil icon"></i><% end %>
    <%= link_to @ship, method: :delete, data: { confirm: 'Are you sure?' }, class: "item" do %>Delete <i class="red delete icon"></i><% end %>
    <%= link_to ship_path, class: "item" do %>Back <i class="left icon"></i><% end %>
  </div>
</div>

<% content_for :post_map_js do %>
  <% last_poc = nil %>
  <% @ship.port_of_call.each do |poc| %>
    <% map_marker(poc.port) %>
    <% if last_poc %>
      <% 
          route = Route.find_by(:from => last_poc.port.id, :to => poc.port.id)
      if route
        route = route.line
      else
        route = [[last_poc.port.latitude,last_poc.port.longitude],[poc.port.latitude,poc.port.longitude]]
      end
      %>
    addCruiseSegment('<%= last_poc.id %>_<%= poc.id %>', <%= route %>);
    <% end %>
    <% last_poc = poc %>
  <% end %>
<% end %>
